{"definitions":{"User":{"properties":{"clerk_user_id":{"type":"string"},"created_at":{"format":"date-time","type":"string"},"customer_rating":{"format":"float","type":"number"},"email":{"type":"string"},"first_name":{"type":"string"},"last_name":{"type":"string"},"phone_number":{"nullable":true,"type":"string"},"runner_rating":{"format":"float","type":"number"},"stripe_connect_account_id":{"nullable":true,"type":"string"},"stripe_customer_id":{"nullable":true,"type":"string"},"updated_at":{"format":"date-time","type":"string"},"user_stripe_card":{"nullable":true,"properties":{"brand":{"type":"string"},"exp_month":{"type":"integer"},"exp_year":{"type":"integer"},"last4":{"type":"string"},"payment_method_id":{"type":"string"},"updated_at":{"format":"date-time","type":"string"}},"type":"object"},"username":{"nullable":true,"type":"string"}},"type":"object"}},"info":{"description":"powered by Flasgger","termsOfService":"/tos","title":"A swagger API","version":"0.0.1"},"paths":{"/api/health":{"get":{"responses":{"200":{"description":"Service is healthy.","schema":{"properties":{"status":{"example":"healthy","type":"string"}},"type":"object"}}},"summary":"Basic health check endpoint","tags":["Health"]}},"/api/user/list-users":{"get":{"description":"Retrieves all Clerk User IDs stored in the system. Useful for debugging/testing.","responses":{"200":{"description":"List of user IDs retrieved.","schema":{"properties":{"message":{"description":"Included if no users are found.","type":"string"},"success":{"example":true,"type":"boolean"},"userIds":{"items":{"type":"string"},"type":"array"}},"type":"object"}},"500":{"description":"Internal Server Error"}},"summary":"Get a list of all Clerk User IDs.","tags":["Users"]}},"/api/user/sync-from-frontend":{"post":{"consumes":["application/json"],"description":"Creates or updates a user based on data provided (typically from Clerk via the frontend). Handles creation of associated Stripe Customer and Connect accounts for new users. Avoids overwriting existing payment data during profile-only updates.","parameters":[{"in":"body","name":"body","required":true,"schema":{"properties":{"clerk_user_id":{"type":"string"},"email":{"format":"email","type":"string"},"first_name":{"type":"string"},"last_name":{"type":"string"},"phone_number":{"nullable":true,"type":"string"},"profile_update_only":{"default":false,"description":"Set to true to prevent overwriting payment data during profile updates.","type":"boolean"},"username":{"nullable":true,"type":"string"}},"required":["clerk_user_id"],"type":"object"}}],"produces":["application/json"],"responses":{"200":{"description":"User synced successfully.","schema":{"properties":{"message":{"type":"string"},"success":{"example":true,"type":"boolean"},"user":{"$ref":"#/definitions/User"}},"type":"object"}},"400":{"description":"Bad Request (e.g., missing clerk_user_id)"},"500":{"description":"Internal Server Error (including Stripe errors)"}},"summary":"Sync user data from frontend (Clerk).","tags":["Users","Sync"]}},"/api/user/temp":{"post":{"consumes":["application/json"],"description":"Creates a user record with a temporary, generated Clerk ID. Useful for testing or specific setup scenarios.","parameters":[{"in":"body","name":"body","required":true,"schema":{"properties":{"email":{"example":"temp_user@example.com","format":"email","type":"string"},"first_name":{"example":"Temp","type":"string"},"last_name":{"example":"User","type":"string"},"phone_number":{"example":"+1234567890","type":"string"},"stripe_customer_id":{"example":"cus_...","type":"string"},"user_stripe_card":{"description":"Legacy card details (optional)","type":"object"},"username":{"example":"tempuser","type":"string"}},"required":["email"],"type":"object"}}],"produces":["application/json"],"responses":{"201":{"description":"Temporary user created successfully.","schema":{"properties":{"message":{"type":"string"},"success":{"example":true,"type":"boolean"},"user":{"properties":{"clerk_user_id":{"type":"string"},"email":{"type":"string"},"first_name":{"type":"string"},"last_name":{"type":"string"}},"type":"object"}},"type":"object"}},"400":{"description":"Bad Request (e.g., missing email, email exists)"},"500":{"description":"Internal Server Error"}},"summary":"Create a temporary user.","tags":["Users"]}},"/api/user/{clerk_user_id}":{"get":{"parameters":[{"description":"The Clerk User ID of the user to retrieve.","in":"path","name":"clerk_user_id","required":true,"type":"string"},{"default":true,"description":"Whether to include payment details in the response.","in":"query","name":"includePaymentDetails","required":false,"type":"boolean"}],"responses":{"200":{"description":"User details retrieved successfully.","schema":{"properties":{"success":{"example":true,"type":"boolean"},"user":{"$ref":"#/definitions/User"}},"type":"object"}},"404":{"description":"User not found"},"500":{"description":"Internal Server Error"}},"summary":"Get user details by Clerk User ID.","tags":["Users"]}},"/api/user/{clerk_user_id}/connect-account":{"get":{"parameters":[{"description":"The Clerk User ID.","in":"path","name":"clerk_user_id","required":true,"type":"string"}],"responses":{"200":{"description":"Stripe Connect account ID retrieved.","schema":{"properties":{"stripe_connect_account_id":{"example":"acct_...","type":"string"},"success":{"example":true,"type":"boolean"}},"type":"object"}},"404":{"description":"User not found"},"500":{"description":"Internal Server Error"}},"summary":"Get user's Stripe Connect account ID.","tags":["Stripe Connect"]},"put":{"consumes":["application/json"],"parameters":[{"description":"The Clerk User ID.","in":"path","name":"clerk_user_id","required":true,"type":"string"},{"in":"body","name":"body","required":true,"schema":{"properties":{"stripe_connect_account_id":{"example":"acct_...","type":"string"}},"required":["stripe_connect_account_id"],"type":"object"}}],"produces":["application/json"],"responses":{"200":{"description":"Connect account ID updated successfully.","schema":{"properties":{"message":{"type":"string"},"success":{"example":true,"type":"boolean"},"user":{"properties":{"clerkUserId":{"type":"string"},"stripeConnectAccountId":{"type":"string"}},"type":"object"}},"type":"object"}},"400":{"description":"Bad Request (e.g., missing connect account ID)"},"404":{"description":"User not found"},"500":{"description":"Internal Server Error"}},"summary":"Update user's Stripe Connect account ID.","tags":["Stripe Connect"]}},"/api/user/{clerk_user_id}/payment":{"delete":{"description":"Removes the stored primary payment method details for the user. Consider using DELETE /user/{clerk_user_id}/payment-methods instead.","parameters":[{"description":"The Clerk User ID.","in":"path","name":"clerk_user_id","required":true,"type":"string"}],"responses":{"200":{"description":"Payment information deleted successfully.","schema":{"properties":{"message":{"type":"string"},"success":{"example":true,"type":"boolean"}},"type":"object"}},"400":{"description":"User has no payment method to delete"},"404":{"description":"User not found"},"500":{"description":"Internal Server Error"}},"summary":"Delete user's primary payment method.","tags":["Payments"]},"get":{"parameters":[{"description":"The Clerk User ID.","in":"path","name":"clerk_user_id","required":true,"type":"string"}],"responses":{"200":{"description":"Payment information retrieved.","schema":{"properties":{"payment_info":{"properties":{"card_type":{"type":"string"},"expiry_month":{"type":"integer"},"expiry_year":{"type":"integer"},"last_four":{"type":"string"},"payment_method_id":{"type":"string"}},"type":"object"},"success":{"example":true,"type":"boolean"}},"type":"object"}},"400":{"description":"User has no payment method"},"404":{"description":"User not found"},"500":{"description":"Internal Server Error"}},"summary":"Get user's primary payment information (formatted).","tags":["Payments"]},"put":{"consumes":["application/json"],"description":"Updates the user's primary payment method using a Stripe PaymentMethod ID. Retrieves details from Stripe and stores them. Legacy format support is deprecated.","parameters":[{"description":"The Clerk User ID.","in":"path","name":"clerk_user_id","required":true,"type":"string"},{"in":"body","name":"body","required":true,"schema":{"properties":{"paymentMethodId":{"example":"pm_...","type":"string"}},"required":["paymentMethodId"],"type":"object"}}],"produces":["application/json"],"responses":{"200":{"description":"Payment information updated successfully.","schema":{"properties":{"message":{"type":"string"},"success":{"example":true,"type":"boolean"}},"type":"object"}},"400":{"description":"Bad Request (e.g., missing data)"},"404":{"description":"User not found"},"500":{"description":"Internal Server Error (including Stripe API errors)"}},"summary":"Update user's primary payment method.","tags":["Payments"]}},"/api/user/{clerk_user_id}/payment-methods":{"delete":{"description":"Removes the stored primary payment method details for the user.","parameters":[{"description":"The Clerk User ID.","in":"path","name":"clerk_user_id","required":true,"type":"string"}],"responses":{"200":{"description":"Payment method deleted successfully.","schema":{"properties":{"message":{"type":"string"},"success":{"example":true,"type":"boolean"}},"type":"object"}},"400":{"description":"User has no payment method to delete"},"404":{"description":"User not found"},"500":{"description":"Internal Server Error"}},"summary":"Delete user's primary payment method.","tags":["Payments"]},"post":{"consumes":["application/json"],"description":"Adds a Stripe PaymentMethod to the user, attaches it to their Stripe Customer (creating one if needed), sets it as default, and stores card details.","parameters":[{"description":"The Clerk User ID.","in":"path","name":"clerk_user_id","required":true,"type":"string"},{"in":"body","name":"body","required":true,"schema":{"properties":{"payment_method_id":{"example":"pm_...","type":"string"}},"required":["payment_method_id"],"type":"object"}}],"produces":["application/json"],"responses":{"200":{"description":"Payment method added successfully.","schema":{"properties":{"description":{"type":"string"},"payment_info":{"properties":{"brand":{"type":"string"},"exp_month":{"type":"integer"},"exp_year":{"type":"integer"},"last4":{"type":"string"},"payment_method_id":{"type":"string"},"updated_at":{"format":"date-time","type":"string"}},"type":"object"},"success":{"example":true,"type":"boolean"}},"type":"object"}},"400":{"description":"Bad Request (e.g., missing payment method ID, Stripe error)"},"404":{"description":"User not found"},"500":{"description":"Internal Server Error (including Stripe API key config error)"}},"summary":"Add a payment method to a user.","tags":["Payments"]}},"/api/user/{clerk_user_id}/update-customer-rating":{"post":{"consumes":["application/json"],"parameters":[{"description":"The Clerk User ID.","in":"path","name":"clerk_user_id","required":true,"type":"string"},{"in":"body","name":"body","required":true,"schema":{"properties":{"rating":{"example":4.5,"format":"float","type":"number"}},"required":["rating"],"type":"object"}}],"produces":["application/json"],"responses":{"200":{"description":"Customer rating updated successfully.","schema":{"properties":{"message":{"type":"string"},"success":{"example":true,"type":"boolean"}},"type":"object"}},"400":{"description":"Bad Request (e.g., missing rating)"},"404":{"description":"User not found"},"500":{"description":"Internal Server Error"}},"summary":"Update user's customer rating.","tags":["Ratings"]}},"/api/user/{clerk_user_id}/update-runner-rating":{"post":{"consumes":["application/json"],"parameters":[{"description":"The Clerk User ID.","in":"path","name":"clerk_user_id","required":true,"type":"string"},{"in":"body","name":"body","required":true,"schema":{"properties":{"rating":{"example":4.8,"format":"float","type":"number"}},"required":["rating"],"type":"object"}}],"produces":["application/json"],"responses":{"200":{"description":"Runner rating updated successfully.","schema":{"properties":{"message":{"type":"string"},"success":{"example":true,"type":"boolean"}},"type":"object"}},"400":{"description":"Bad Request (e.g., missing rating)"},"404":{"description":"User not found"},"500":{"description":"Internal Server Error"}},"summary":"Update user's runner rating.","tags":["Ratings"]}}},"swagger":"2.0"}
