{"definitions":{"Payment":{"properties":{"amount":{"format":"float","type":"number"},"created_at":{"format":"date-time","type":"string"},"currency":{"example":"sgd","type":"string"},"customer_id":{"type":"string"},"id":{"description":"Internal primary key","type":"integer"},"order_id":{"format":"uuid","type":"string"},"payment_id":{"description":"Public unique ID for the payment record","format":"uuid","type":"string"},"runner_id":{"nullable":true,"type":"string"},"status":{"enum":["AUTHORIZED","SUCCEEDED","REVERTED","FAILED"],"type":"string"},"stripe_payment_intent_id":{"nullable":true,"type":"string"},"stripe_transfer_id":{"nullable":true,"type":"string"},"updated_at":{"format":"date-time","type":"string"}},"type":"object"}},"info":{"description":"powered by Flasgger","termsOfService":"/tos","title":"A swagger API","version":"0.0.1"},"paths":{"/health":{"get":{"responses":{"200":{"description":"Service is healthy.","schema":{"properties":{"status":{"example":"healthy","type":"string"}},"type":"object"}}},"summary":"Health check for the Payment Service API.","tags":["Health"]}},"/history/{user_id}":{"get":{"description":"Fetches total amounts and counts for money spent (as customer) and earned (as runner) by a user.","parameters":[{"description":"The ID of the user (likely Clerk User ID).","in":"path","name":"user_id","required":true,"type":"string"}],"responses":{"200":{"description":"Payment history summary retrieved.","schema":{"properties":{"earnedCount":{"type":"integer"},"spentCount":{"type":"integer"},"totalEarned":{"format":"float","type":"number"},"totalSpent":{"format":"float","type":"number"},"userId":{"type":"string"}},"type":"object"}},"500":{"description":"Internal Server Error (Database or Processing error)"}},"summary":"Get payment history summary for a user.","tags":["Payments"]}},"/payment/{order_id}/status":{"get":{"parameters":[{"description":"The ID of the order associated with the payment.","in":"path","name":"order_id","required":true,"type":"string"}],"responses":{"200":{"description":"Payment status retrieved.","schema":{"properties":{"payment":{"$ref":"#/definitions/Payment"},"success":{"example":true,"type":"boolean"}},"type":"object"}},"404":{"description":"Payment not found for the given order ID."},"500":{"description":"Internal Server Error"}},"summary":"Get payment status for a specific order.","tags":["Payments"]}},"/payment/{payment_id}/details":{"get":{"parameters":[{"description":"The internal UUID of the payment record.","format":"uuid","in":"path","name":"payment_id","required":true,"type":"string"}],"responses":{"200":{"description":"Payment details retrieved.","schema":{"properties":{"payment":{"$ref":"#/definitions/Payment"},"success":{"example":true,"type":"boolean"}},"type":"object"}},"404":{"description":"Payment not found for the given payment ID."},"500":{"description":"Internal Server Error"}},"summary":"Get details for a specific payment by its ID.","tags":["Payments"]}},"/payment/{payment_id}/release":{"post":{"consumes":["application/json"],"description":"Publishes a 'release_payment' command to Kafka, typically used to initiate payment capture and transfer to a runner.","parameters":[{"description":"The internal UUID of the payment record to release.","format":"uuid","in":"path","name":"payment_id","required":true,"type":"string"},{"in":"body","name":"body","required":true,"schema":{"properties":{"runner_connect_account_id":{"description":"Runner's Stripe Connect account ID (acct_...).","type":"string"},"runner_id":{"description":"Clerk User ID of the runner.","type":"string"}},"required":["runner_id","runner_connect_account_id"],"type":"object"}}],"produces":["application/json"],"responses":{"202":{"description":"Release payment command queued successfully.","schema":{"properties":{"correlation_id":{"format":"uuid","type":"string"},"message":{"type":"string"},"success":{"example":true,"type":"boolean"}},"type":"object"}},"400":{"description":"Bad Request (e.g., missing body or required fields)"},"500":{"description":"Failed to publish command to Kafka."},"503":{"description":"Kafka producer unavailable."}},"summary":"Trigger 'release_payment' Kafka command.","tags":["Kafka Triggers"]}},"/payment/{payment_id}/revert":{"post":{"consumes":["application/json"],"description":"Publishes a 'revert_payment' command to Kafka, typically used to initiate payment cancellation or refund.","parameters":[{"description":"The internal UUID of the payment record to revert.","format":"uuid","in":"path","name":"payment_id","required":true,"type":"string"},{"in":"body","name":"body","required":false,"schema":{"properties":{"reason":{"description":"Optional reason for reverting the payment.","type":"string"}},"type":"object"}}],"produces":["application/json"],"responses":{"202":{"description":"Revert payment command queued successfully.","schema":{"properties":{"correlation_id":{"format":"uuid","type":"string"},"message":{"type":"string"},"success":{"example":true,"type":"boolean"}},"type":"object"}},"500":{"description":"Failed to publish command to Kafka."},"503":{"description":"Kafka producer unavailable."}},"summary":"Trigger 'revert_payment' Kafka command.","tags":["Kafka Triggers"]}},"/stripe-webhook":{"post":{"consumes":["application/json"],"description":"Receives events from Stripe, verifies the signature, processes payment_intent events (succeeded, canceled, failed), updates local DB status, and publishes Kafka events (payment.authorized, payment.failed).","parameters":[{"description":"Stripe webhook signature for verification.","in":"header","name":"Stripe-Signature","required":true,"type":"string"},{"description":"Raw Stripe event payload (JSON).","in":"body","name":"body","required":true,"schema":{"properties":{"data":{"type":"object"},"id":{"example":"evt_...","type":"string"},"type":{"example":"payment_intent.succeeded","type":"string"}},"type":"object"}}],"produces":["application/json"],"responses":{"200":{"description":"Webhook received and acknowledged.","schema":{"properties":{"received":{"example":true,"type":"boolean"}},"type":"object"}},"400":{"description":"Bad Request (e.g., invalid payload, invalid signature)"},"500":{"description":"Internal Server Error (e.g., webhook secret not configured, processing error)"}},"summary":"Handle incoming Stripe webhook events.","tags":["Webhooks"]}}},"swagger":"2.0"}
