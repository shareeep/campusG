generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ScheduledEvent {
  id             String           @id @default(uuid())
  eventType      EventType
  entityId       String           // ID of the entity this event relates to (e.g., orderId)
  scheduledTime  DateTime         // When this event should trigger
  status         ScheduleStatus   @default(PENDING)
  payload        Json?            // Additional data needed to process the event
  retryCount     Int              @default(0)
  lastProcessed  DateTime?        // When this event was last processed
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  @@index([scheduledTime, status])
  @@index([entityId, eventType])
}

enum EventType {
  ORDER_TIMEOUT          // Check if order has timed out
  PAYMENT_AUTHORIZATION_EXPIRY // Check if payment authorization has expired
  DELIVERY_REMINDER      // Send reminder for delivery
  ESCROW_TIMEOUT         // Check if escrow has timed out
}

enum ScheduleStatus {
  PENDING     // Event is scheduled but not processed yet
  PROCESSING  // Event is currently being processed
  COMPLETED   // Event has been processed successfully
  FAILED      // Event processing failed
  CANCELLED   // Event was cancelled
}
